# 简介

这是一个使用 Laravel5.4 构建的一个简单的后台管理系统，主要功能包含后台用户管理、权限管理、文件管理、文章管理

# 环境

Laravel5.4 + PHP5.6 + MySQL5.5 + Redis

# 安装

 ```
    git clone git@github.com:cxzfb/laravel-basecms.git

    cd laravel-basecms 

    composer install 

    php artisan migrate

 ```

 在根目录下 `.env` 中配置数据库和Redis数据库连接信息


# 登录相关

用户登录是由系统生成Token后，以Token为key，用户信息为value，存入Redis。Session中存储Token。


# 功能详解

### 用户管理

1. 超级管理员默认账号：admin
2. 每个用户注册后，将自动生成一个小组(也可称为机构)；
3. 通过小组内添加的用户将不会生成小组(后面 `机构管理` 会提到)

### 角色管理

1. 用户的权限列表在 `App\Http\Controlles\Controller.php@limitList()` 中，因为考虑到实在没必要放在数据库，权限都是由程序员手动加的
2. 1个用户可拥有多个角色，采用`组-用户-用户组`的设计来设计的
3. 检验权限是在`Route`中通过 `App\Http\Middleware\checkRole` 进行校验，在路由处控制权限

### 机构管理

1. 机构最初构想：内容管理系统，当一个机构注册过后，不一定由一个账号来维护内容和图片，可将普通功能分配至员工账号，由员工来完成普通的操作。
2. `“员工管理”` 是指添加指定的员工账号进行对该机构的资源(文件，文章)进行发布、删除。
3. `“操作日志”` 是指员工在对数据的增删改时的记录日志（仅机构创建者可操作）；
4. 员工执行的删除文章实际上是将文章进行了屏蔽，超管以及赋予`全站文章管理`权限的用户可对文章进行恢复。

### 站内信/组内信

1. 站内信功能开放给超管以及赋予该权限的用户使用，可选择对`全站`，`部分组`，`部分用户`进行站内信推送。
2. 站内信推送功能由`“用户执行推送 -> Listener监听 -> 启用Redis队列 -> Redis队列批量添加用户+站内信关系”`
3. 组内信权限由机构创建者拥有，可选择`全组`，`组内部分人员`进行组内信推送。

### 分类管理(文章)

1. 权限开放给超管以及赋予该权限的用户使用，属于全站功能。
2. 分类共2级(其实是可无限级的，只是UI有点难做，就直接只做2级了)，1级默认不放文章，统管二级分类，但UI上未做限制，即1级分类下也可放文章。
3. 分类中包含一个字段 `key` ，该字段用于开发者调用API时使用，比如某分类应放置在网站前台，可用 `web_index` 标志；放置于网站推荐行列，可用 `web_recommend` 标志等等。

### 文章管理(全站)

1. 权限开放给超管以及赋予该权限的用户使用，属于全站功能。
2. 原则上是不允许有权限的人对文章内容进行更改，只允许对文章执行`置顶`，`屏蔽`，`删除`操作。
3. 机构中的用户对文章进行删除后，实际上是将文章进行了 `屏蔽` 操作，超管可对文章选择 `恢复(取消屏蔽)` 或 `删除` 操作。
4. 置顶(待开发)，是可以选择在 `“所有文章”` 中置顶或 `“某分类”` 中置顶。


### 文章管理

1. 权限由机构组内所有成员可操作，只可操作本机构组内的文章。
2. 普通模式、Markdown模式是指普通文章，就是一次性编辑完可发布的。(正在考虑加入版本更新记录)；
3. 图文模式是指头条中一张图配一段文字或众多网站中的 `“关于我们”` 中的分段文字。

### 文件管理

1. 权限由机构组内所有成员可操作，只可操作本机构组内的文件。
2. 文章分类：用户自注册后，会自动创建一个默认分类，且该默认分类是不允许被删除的。
3. 上传文件后会直接注入 `“默认分类”` 中，然后由用户执行修改操作可修改分类。
4. 文件没有伪删除功能，删除就直接移除了文件和记录。

### 通知

1. 因为考虑到可能会有大量的数据涌入，直接查询数据库会多多少少影响性能，所以UI层面上也没做 `“小红点”` 的提醒，正在考虑是否将通知转入Redis中。

### 轮播图(待开发)
### 网站配置(待开发)
### 首页(待开发，不知道要弄些啥)


### 数据库字段信息

##### -.- 其实这个是可以看 /database/migrations/* 

其中 tb_msgs/tb_members/tb_member_token 这三个还没开发，只是创建了表

### API文档( 不慌，只写了2个API，还写完  )
 